(function(t){function e(e){for(var r,o,u=e[0],s=e[1],l=e[2],c=0,d=[];c<u.length;c++)o=u[c],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&d.push(n[o][0]),n[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r]);m&&m(e);while(d.length)d.shift()();return i.push.apply(i,l||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],r=!0,u=1;u<a.length;u++){var s=a[u];0!==n[s]&&(r=!1)}r&&(i.splice(e--,1),t=o(o.s=a[0]))}return t}var r={},n={app:0},i=[];function o(e){if(r[e])return r[e].exports;var a=r[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=t,o.c=r,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(a,r,function(e){return t[e]}.bind(null,r));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var u=window["webpackJsonp"]=window["webpackJsonp"]||[],s=u.push.bind(u);u.push=e,u=u.slice();for(var l=0;l<u.length;l++)e(u[l]);var m=s;i.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";var r=a("85ec"),n=a.n(r);n.a},1:function(t,e){},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var r=a("2b0e"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[""===this.roomName?a("div",{attrs:{div:""}},[a("Entrance",{on:{"enter-room":t.enterRoom}})],1):a("div",[a("Game",{attrs:{roomName:this.roomName,playerName:this.playerName,id:this.id}})],1)])},i=[],o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"entrance"},[a("form",{on:{submit:t.enterRoom}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.roomName,expression:"roomName"}],attrs:{type:"text",placeholder:"ルーム名"},domProps:{value:t.roomName},on:{input:function(e){e.target.composing||(t.roomName=e.target.value)}}}),a("input",{directives:[{name:"model",rawName:"v-model",value:t.playerName,expression:"playerName"}],attrs:{type:"text",placeholder:"プレイヤー名"},domProps:{value:t.playerName},on:{input:function(e){e.target.composing||(t.playerName=e.target.value)}}}),a("input",{staticClass:"btn",attrs:{type:"submit",value:"GO"}})])])},u=[],s={name:"Entrance",data:function(){return{roomName:"",playerName:""}},methods:{enterRoom:function(t){t.preventDefault();var e={roomName:this.roomName,playerName:this.playerName};this.$emit("enter-room",e),this.roomName="",this.playerName=""}}},l=s,m=a("2877"),c=Object(m["a"])(l,o,u,!1,null,null,null),d=c.exports,h=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"game"},[a("Board",{ref:"BoardComponent",attrs:{players:t.players,gameState:t.gameState,id:t.id},on:{attack:t.attack,protect:t.protect,check:t.check,vote:t.vote}}),"preparation"===this.gameState?a("div",[a("button",{attrs:{button:""},on:{click:t.assignRoles}},[t._v("Assign Roles")])]):t._e(),"preparation"===this.gameState?a("div",[a("button",{on:{click:t.startGame}},[t._v("ゲームを開始")])]):a("div",[a("button",{on:{click:t.changeGameState}},[t._v("次のターンに進む")])]),a("div",[t._v("現在は "+t._s(this.gameState))])],1)},f=[],p=(a("99af"),a("7db0"),a("c740"),a("4160"),a("a630"),a("45fc"),a("b0c0"),a("d3b7"),a("6062"),a("3ca3"),a("159b"),a("ddb0"),a("2909")),v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"board"},t._l(t.players,(function(e){return a("Player",{key:e.id,ref:"PlayerComponent",refInFor:!0,attrs:{id:e.id,yourId:t.id,name:e.name,role:e.role,status:e.status,otherPlayers:t.players,gameState:t.gameState},on:{attack:t.attack,protect:t.protect,check:t.check,vote:t.vote}})})),1)},N=[],g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("button",{staticStyle:{width:"250px",height:"250px"}},[t._v(" "+t._s(t.name)+" "),a("div",["Citizen"===this.role?a("p",[a("Citizen")],1):"FortuneTeller"===this.role?a("p",[a("FortuneTeller",{attrs:{id:t.id,yourId:t.yourId,gameState:t.gameState,validTargets:t.alivePlayers},on:{check:t.check}})],1):"Knight"===this.role?a("p",[a("Knight",{attrs:{gameState:t.gameState,yourId:t.yourId,validTargets:t.alivePlayers},on:{protect:t.protect}})],1):"Madman"===this.role?a("p",[a("Madman")],1):"Werewolf"===this.role?a("p",[a("Werewolf",{ref:"WerewolfComponent",attrs:{id:t.id,yourId:t.yourId,gameState:t.gameState,validTargets:t.attackablePlayers,attacked:t.attacked},on:{attack:t.attack}})],1):a("p",[t._v("役職を決めてください。")]),"noon"===t.gameState&&"alive"===t.status?a("div",[!1===t.voted||!0===t.voted&&""===t.voteTarget?a("div",[t._v(" 投票する "),t._l(t.alivePlayers,(function(e){return a("li",{key:e.id},[a("input",{staticClass:"btn",attrs:{type:"submit"},domProps:{value:e.name},on:{click:function(a){return t.vote(e.id,e.name)}}})])}))],2):t._e()]):t._e()]),t._v(" "+t._s(t.status)+" ")])},y=[],k=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t._v(" "+t._s(t.title)+" ")])},C=[],T={name:"citizen",data:function(){return{title:"市民"}}},S=T,M=Object(m["a"])(S,k,C,!1,null,null,null),x=M.exports,E=function(){var t=this,e=t.$createElement,a=t._self._c||e;return"night"===this.gameState&&t.id===t.yourId&&"alive"===t.status?a("div",[t._v(" "+t._s(t.title)+" "),a("br"),a("br"),t._v("占う "),t._l(t.validTargets,(function(e){return a("li",{key:e.id},[a("input",{staticClass:"btn",attrs:{type:"submit"},domProps:{value:e.name},on:{click:function(a){return t.check(e.id)}}})])}))],2):a("div",[t._v(" "+t._s(t.title)+" "),a("br"),a("br")])},b=[],_={name:"fortuneteller",data:function(){return{title:"占い師"}},props:{id:String,yourId:String,validTargets:Array,status:String,gameState:String},methods:{check:function(t){this.$emit("check",t)}}},R=_,w=Object(m["a"])(R,E,b,!1,null,null,null),A=w.exports,P=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t._v(" "+t._s(t.title)+" "),a("br"),a("br"),"night"===this.gameState?a("div",[t._v(" 生存者 "),t._l(t.validTargets,(function(e){return a("li",{key:e.id},[a("input",{staticClass:"btn",attrs:{type:"submit"},domProps:{value:e.name},on:{click:function(a){return t.protect(e.id)}}})])}))],2):t._e()])},O=[],W={name:"knight",data:function(){return{title:"騎士"}},props:{validTargets:Array,gameState:String},methods:{protect:function(t){alert("clicked on "+t+" from knight.vue"),this.$emit("protect",t)}}},I=W,$=Object(m["a"])(I,P,O,!1,null,null,null),j=$.exports,F=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t._v(t._s(t.title))])},G=[],K={name:"madman",data:function(){return{title:"狂人"}}},z=K,L=Object(m["a"])(z,F,G,!1,null,null,null),D=L.exports,B=function(){var t=this,e=t.$createElement,a=t._self._c||e;return"night"===t.gameState&&t.id===t.yourId?a("div",[t._v(" "+t._s(t.title)+" "),a("br"),a("br"),!1===t.attacked||!0===t.attacked&&""===t.attackTarget?a("div",[t._v(" 襲撃する "),t._l(t.validTargets,(function(e){return a("li",{key:e.id},[a("input",{staticClass:"btn",attrs:{type:"submit"},domProps:{value:e.name},on:{click:function(a){return t.attack(e.id,e.name)}}})])}))],2):a("div",[t._v(t._s(t.attackTarget)+" を襲撃しました。")])]):a("div",[t._v(" "+t._s(t.title)+" "),a("br"),a("br")])},U=[],V={name:"werewolf",data:function(){return{title:"人狼",attackTarget:""}},props:{id:String,yourId:String,validTargets:Array,gameState:String,attacked:Boolean},methods:{attack:function(t,e){var a=this.yourId;this.attackTarget=e,this.$emit("attack",{id:t,yourId:a})},clear:function(){this.attacked=!1,this.attackTarget=""},clearAttackedStatus:function(){this.attacked=!1,this.attackTarget=""}},mounted:function(){var t=this;this.$on("clear-werewolf",(function(){t.attacked=!1,t.attackTarget=""}))}},H=V,J=Object(m["a"])(H,B,U,!1,null,null,null),Y=J.exports,q={name:"Player",components:{Citizen:x,FortuneTeller:A,Knight:j,Madman:D,Werewolf:Y},props:{id:String,yourId:String,name:String,role:String,status:String,otherPlayers:Array,gameState:String},data:function(){return{attacked:!1,voteTarget:""}},computed:{alivePlayers:function(){var t=this,e=[];return this.otherPlayers.forEach((function(a){"alive"!==a.status&&"protected"!==a.status||a.name===t.name||e.push(a)})),e},attackablePlayers:function(){var t=[];return this.alivePlayers.forEach((function(e){"Werewolf"!==e.role&&t.push(e)})),t}},methods:{attack:function(t){var e=t.id,a=t.yourId;this.attacked=!0,this.$emit("attack",{id:e,yourId:a})},protect:function(t){alert("message from plauyer.vue "+t+" triggered from werewolf.vue"),this.$emit("protect",t)},check:function(t){alert("message from player.vue "+t+" triggered from FortuneTeller.vue"),this.$emit("check",t)},clearAttackedStatus:function(){this.attacked=!1,this.$refs.WerewolfComponent.attackTarget=""},vote:function(t){alert("clicked on "+t+" from Player.vue"),this.$emit("vote",t)}}},Q=q,X=Object(m["a"])(Q,g,y,!1,null,null,null),Z=X.exports,tt={name:"Players",components:{Player:Z},props:{players:Array,gameState:String,id:String},methods:{attack:function(t){var e=t.id,a=t.yourId;this.$emit("attack",{id:e,yourId:a})},protect:function(t){this.$emit("protect",t)},check:function(t){this.$emit("check",t)},clearAttackedStatus:function(){this.$refs.PlayerComponent.forEach((function(t){"Werewolf"===t.role&&t.clearAttackedStatus()}))},vote:function(t){this.$emit("vote",t)}}},et=tt,at=Object(m["a"])(et,v,N,!1,null,null,null),rt=at.exports,nt=a("8055"),it=a.n(nt),ot={name:"Game",components:{Board:rt},props:{id:String,roomName:String,playerName:String},data:function(){return{socket:it()("localhost:9090"),gameState:"preparation",players:[],attackCandidates:[],attackers:[],voteCandidates:[{id:"0",vote:0},{id:"1",vote:0},{id:"2",vote:0},{id:"3",vote:0},{id:"4",vote:0},{id:"5",vote:0}]}},created:function(){var t=this,e=this.roomName,a=this.playerName,r=this.id;this.socket.emit("ENTER-ROOM",{roomName:e,playerName:a,id:r}),this.socket.on("PASS-PLAYERS",(function(e){t.players=e}));var n=this.players.findIndex((function(e){return e.name===t.playerName}));if(-1===n){var i={id:this.id,name:this.playerName,role:"",status:"alive"};this.addPlayer(i)}this.socket.on("PASS-GAMESTATE",(function(e){t.gameState=e.gameState}))},mounted:function(){var t=this;this.socket.on("USER-ENTERED",(function(e){if(!t.players.some((function(t){return t.name===e.playerName}))){var a={id:e.id,name:e.playerName,role:"",status:"alive"};t.addPlayer(a)}var r=t.players,n=t.roomName,i=t.gameState;t.socket.emit("PASS-PLAYERS",{roomName:n,players:r}),t.socket.emit("PASS-GAMESTATE",{roomName:n,gameState:i})})),this.socket.on("ROLES-ASSIGNED",(function(e){e.forEach((function(e){t.players.find((function(t){return t.name===e.name})).role=e.role}))})),this.socket.on("GAME-STARTED",(function(e){t.gameState=e})),this.socket.on("GAMESTATE-CHANGED",(function(e){t.gameState=e})),this.socket.on("WEREWOLF-ATTACKED",(function(e){var a=t.roomName,r=e.targetId,n=e.wolfId;if("Werewolf"===t.yourRole&&t.id!==n&&(t.attackCandidates=[].concat(Object(p["a"])(t.attackCandidates),[r]),t.attackers=[].concat(Object(p["a"])(t.attackers),[n]),t.aliveWerewolves.length===t.attackCandidates.length))if(t.isAttackUnanimous()){var i=Array.from(new Set(t.attackCandidates));t.processAttack(i)}else t.attackCandidates=[],t.attackers=[],alert("Revote"),t.$refs.BoardComponent.clearAttackedStatus(),t.socket.emit("WEREWOLF-REVOTE",a)})),this.socket.on("ATTACK-RESULT",(function(e){var a=e.targetId;e.wolfId!==t.id&&t.players.forEach((function(e){"protected"===e.status?(e.status="alive","Werewolf"===t.yourRole&&alert("襲撃失敗")):e.id===a&&(e.status="dead","Werewolf"===t.yourRole&&alert("襲撃成功"))})),t.attackCandidate=[],t.attackers=[]})),this.socket.on("WEREWOLF-REVOTE",(function(){t.attackCandidates=[],t.attackers=[],alert("Revote"),t.$refs.BoardComponent.clearAttackedStatus()}))},computed:{aliveWerewolves:function(){var t=[];return this.players.forEach((function(e){"alive"===e.status&&"Werewolf"===e.role&&t.push(e)})),t},yourRole:function(){var t=this,e="",a=this.players.find((function(e){return e.id===t.id}));return e=a.role,e},alivePlayers:function(){var t=this,e=[];return this.players.forEach((function(a){"alive"===a.status&&a.name!==t.name&&e.push(a)})),e}},methods:{addPlayer:function(t){this.players=[].concat(Object(p["a"])(this.players),[t])},assignRoles:function(){var t=[];15===this.players.length?(t=[{Title:"Citizen",MaxNum:7,CurrentNum:0},{Title:"Werewolf",MaxNum:3,CurrentNum:0},{Title:"FortuneTeller",MaxNum:1,CurrentNum:0},{Title:"Knight",MaxNum:2,CurrentNum:0},{Title:"Madman",MaxNum:2,CurrentNum:0}],this.getRandomRole(t)):14===this.players.length?(t=[{Title:"Citizen",MaxNum:7,CurrentNum:0},{Title:"Werewolf",MaxNum:3,CurrentNum:0},{Title:"FortuneTeller",MaxNum:1,CurrentNum:0},{Title:"Knight",MaxNum:1,CurrentNum:0},{Title:"Madman",MaxNum:2,CurrentNum:0}],this.getRandomRole(t)):13===this.players.length?(t=[{Title:"Citizen",MaxNum:6,CurrentNum:0},{Title:"Werewolf",MaxNum:3,CurrentNum:0},{Title:"FortuneTeller",MaxNum:1,CurrentNum:0},{Title:"Knight",MaxNum:1,CurrentNum:0},{Title:"Madman",MaxNum:2,CurrentNum:0}],this.getRandomRole(t)):12===this.players.length?(t=[{Title:"Citizen",MaxNum:5,CurrentNum:0},{Title:"Werewolf",MaxNum:3,CurrentNum:0},{Title:"FortuneTeller",MaxNum:1,CurrentNum:0},{Title:"Knight",MaxNum:1,CurrentNum:0},{Title:"Madman",MaxNum:2,CurrentNum:0}],this.getRandomRole(t)):11===this.players.length?(t=[{Title:"Citizen",MaxNum:5,CurrentNum:0},{Title:"Werewolf",MaxNum:2,CurrentNum:0},{Title:"FortuneTeller",MaxNum:1,CurrentNum:0},{Title:"Knight",MaxNum:1,CurrentNum:0},{Title:"Madman",MaxNum:2,CurrentNum:0}],this.getRandomRole(t)):10===this.players.length?(t=[{Title:"Citizen",MaxNum:4,CurrentNum:0},{Title:"Werewolf",MaxNum:2,CurrentNum:0},{Title:"FortuneTeller",MaxNum:1,CurrentNum:0},{Title:"Knight",MaxNum:1,CurrentNum:0},{Title:"Madman",MaxNum:2,CurrentNum:0}],this.getRandomRole(t)):9===this.players.length?(t=[{Title:"Citizen",MaxNum:4,CurrentNum:0},{Title:"Werewolf",MaxNum:2,CurrentNum:0},{Title:"FortuneTeller",MaxNum:1,CurrentNum:0},{Title:"Knight",MaxNum:1,CurrentNum:0},{Title:"Madman",MaxNum:1,CurrentNum:0}],this.getRandomRole(t)):8===this.players.length?(t=[{Title:"Citizen",MaxNum:3,CurrentNum:0},{Title:"Werewolf",MaxNum:2,CurrentNum:0},{Title:"FortuneTeller",MaxNum:1,CurrentNum:0},{Title:"Knight",MaxNum:1,CurrentNum:0},{Title:"Madman",MaxNum:1,CurrentNum:0}],this.getRandomRole(t)):7===this.players.length?(t=[{Title:"Citizen",MaxNum:2,CurrentNum:0},{Title:"Werewolf",MaxNum:2,CurrentNum:0},{Title:"FortuneTeller",MaxNum:1,CurrentNum:0},{Title:"Knight",MaxNum:1,CurrentNum:0},{Title:"Madman",MaxNum:1,CurrentNum:0}],this.getRandomRole(t)):6===this.players.length?(t=[{Title:"Citizen",MaxNum:2,CurrentNum:0},{Title:"Werewolf",MaxNum:2,CurrentNum:0},{Title:"FortuneTeller",MaxNum:1,CurrentNum:0},{Title:"Knight",MaxNum:1,CurrentNum:0},{Title:"Madman",MaxNum:0,CurrentNum:0}],this.getRandomRole(t)):5===this.players.length?(t=[{Title:"Citizen",MaxNum:2,CurrentNum:0},{Title:"Werewolf",MaxNum:1,CurrentNum:0},{Title:"FortuneTeller",MaxNum:0,CurrentNum:0},{Title:"Knight",MaxNum:1,CurrentNum:0},{Title:"Madman",MaxNum:1,CurrentNum:0}],this.getRandomRole(t)):4===this.players.length&&(t=[{Title:"Citizen",MaxNum:1,CurrentNum:0},{Title:"Werewolf",MaxNum:1,CurrentNum:0},{Title:"FortuneTeller",MaxNum:0,CurrentNum:0},{Title:"Knight",MaxNum:1,CurrentNum:0},{Title:"Madman",MaxNum:1,CurrentNum:0}],this.getRandomRole(t));var e=this.roomName,a=this.players;this.socket.emit("ASSIGN-ROLES",{roomName:e,players:a})},getRandomRole:function(t){this.players.forEach((function(e){while(""===e.role){var a=Math.floor(Math.random()*t.length),r=t[a];console.log(r.MaxNum,r.CurrentNum),r.MaxNum>r.CurrentNum&&(r.CurrentNum+=1,e.role=r.Title)}}))},vote:function(t){var e=this;alert("Vote: passed to Game.vue "+t),this.voteCandidates[0].vote=this.voteCandidates[0].vote+1,this.voteCandidates[t].vote=this.voteCandidates[t].vote+1,alert("vote check:\nPlayerID:"+this.voteCandidates[t].id+"-"+this.voteCandidates[t].vote),this.alivePlayers.length===this.voteCandidates[0].vote&&(this.voteCandidates.sort((function(t,e){return t.vote<e.value?1:t.vote>e.vote?-1:0})),alert("Execution:"+this.voteCandidates[1].id),this.players.forEach((function(t){t.id===e.voteCandidates[1].id&&(t.status="dead",e.voteCandidates=[])})),this.voteCandidates.forEach((function(t){t.vote=0})))},attack:function(t){var e=this.roomName,a=t.id,r=t.yourId;if(this.attackCandidates=[].concat(Object(p["a"])(this.attackCandidates),[a]),this.attackers=[].concat(Object(p["a"])(this.attackers),[r]),this.aliveWerewolves.length===this.attackCandidates.length)if(this.isAttackUnanimous()){var n=Array.from(new Set(this.attackCandidates))[0];this.processAttack(n)}else this.attackCandidates=[],this.attackers=[],alert("Revote"),this.$refs.BoardComponent.clearAttackedStatus(),this.socket.emit("WEREWOLF-REVOTE",{roomName:e});else this.socket.emit("WEREWOLF-ATTACK",{roomName:e,targetId:a,wolfId:r})},protect:function(t){alert("passed to Game.vue"+t),this.players.forEach((function(e){console.log(e.id),console.log(t),e.id===t&&(e.status="protected")}))},check:function(t){this.players.forEach((function(e){e.id===t&&("Werewolf"===e.role?alert(e.name+" is Werewolf"):alert(e.name+" is NOT Werewolf"))}))},startGame:function(){this.gameState="noon";var t=this.roomName,e=this.gameState;this.socket.emit("START-GAME",{roomName:t,gameState:e})},changeGameState:function(){"noon"===this.gameState?this.gameState="night":this.gameState="noon";var t=this.roomName,e=this.gameState;this.socket.emit("CHANGE-GAMESTATE",{roomName:t,gameState:e})},processAttack:function(t){this.players.forEach((function(e){"protected"===e.status?(e.status="alive",alert("襲撃失敗")):e.id===t&&(e.status="dead",alert("襲撃成功"))})),this.attackCandidate=[],this.attackers=[];var e=this.roomName,a=this.id;this.socket.emit("ATTACK-RESULT",{roomName:e,targetId:t,wolfId:a})},isAttackUnanimous:function(){var t=Array.from(new Set(this.attackCandidates));return 1===t.length}}},ut=ot,st=Object(m["a"])(ut,h,f,!1,null,"2ecd71ad",null),lt=st.exports,mt=a("ec26"),ct={name:"App",components:{Game:lt,Entrance:d},data:function(){return{id:"",roomName:"",playerName:"",socketID:""}},methods:{enterRoom:function(t){this.id=Object(mt["a"])(),this.roomName=t.roomName,this.playerName=t.playerName}}},dt=ct,ht=(a("034f"),Object(m["a"])(dt,n,i,!1,null,null,null)),ft=ht.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(t){return t(ft)}}).$mount("#app")},"85ec":function(t,e,a){}});
//# sourceMappingURL=app.806897ba.js.map